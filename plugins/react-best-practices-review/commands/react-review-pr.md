---
description: "Review PR and post results as GitHub comment"
argument-hint: "[PR-number]"
allowed-tools: ["Read", "Grep", "Glob", "Task", "Bash", "Write"]
model: sonnet
---

# PR Review with GitHub Comment

Review a pull request and automatically post the results as a GitHub comment.

**Arguments**: $ARGUMENTS (PR number, optional)

## PR Review Workflow

### 1. Identify PR

If PR number provided, use it. Otherwise, detect current branch's PR:

```bash
# Get current PR
gh pr view --json number,title,headRefName,baseRefName,changedFiles
```

### 2. Get Changed Files

```bash
# List files changed in PR
gh pr diff {pr_number} --name-only
```

Filter to relevant files:
- Include: `*.tsx`, `*.ts`, `*.jsx`, `*.js`
- Exclude: `*.test.*`, `*.spec.*`, `*.stories.*`

### 3. Project Detection

Same as `/react-review`:
- Check React/Next.js version
- Check for React Compiler
- Read project-specific settings

### 4. Launch Review Agents

Launch all 6 agents with PR-specific configuration:

- Confidence threshold: **‚â•85** (balanced for PR)
- Focus on changed files only
- Include file diff context

### 5. Aggregate Results

Same as `/react-review`, but:
- Group issues by file (for inline comments)
- Prepare summary for PR comment

### 6. Generate GitHub Comment

Use `${CLAUDE_PLUGIN_ROOT}/templates/pr-comment.md` template:

```markdown
## üîç React Best Practices Review

**Reviewed by**: react-best-practices-review plugin
**Confidence threshold**: ‚â•85

### Summary
| Level | Count | Description |
|-------|-------|-------------|
| üî¥ CRITICAL | {count} | {description} |
| üü† HIGH | {count} | {description} |
| üü° MEDIUM | {count} | {description} |

### Critical Issues

<details>
<summary>üî¥ Request Waterfall in UserDashboard.tsx:45 (Confidence: 95%)</summary>

**Current Code**:
```tsx
const user = await fetchUser(id);
const orders = await fetchOrders(id);
```

**Suggested Fix**:
```tsx
const [user, orders] = await Promise.all([
  fetchUser(id),
  fetchOrders(id)
]);
```

**Impact**: ~400ms faster initial load

</details>

### High Priority Issues

<details>
<summary>üü† Large Bundle Import in utils/index.ts:12 (Confidence: 92%)</summary>
{issue details}
</details>

### Action Items
- [ ] Fix async waterfall in UserDashboard.tsx
- [ ] Add dynamic import for AdminPanel
- [ ] Consider memoizing ProductList

---
*Generated by [react-best-practices-review](https://github.com/Junhan2/react-best-practices-review)*
```

### 7. Post Comment

```bash
gh pr comment {pr_number} --body "$(cat <<'EOF'
{generated_comment}
EOF
)"
```

### 8. Confirm Success

```
‚úÖ PR Review Complete

üìù PR: #{pr_number} - {pr_title}
üìä Issues Found: {total_count}
   üî¥ CRITICAL: {count}
   üü† HIGH: {count}
   üü° MEDIUM: {count}

üí¨ Comment Posted: {comment_url}

Next Steps:
1. Address critical issues before merging
2. Consider high-priority issues
3. Re-run review after fixes: /react-review-pr {pr_number}
```

## Usage Examples

```bash
# Review current branch's PR
/react-review-pr

# Review specific PR
/react-review-pr 123

# Review PR by URL
/react-review-pr https://github.com/owner/repo/pull/123
```

## GitHub CLI Requirements

Requires `gh` CLI to be installed and authenticated:

```bash
# Check if gh is available
gh auth status
```

If not authenticated, the command will inform the user to run:
```bash
gh auth login
```

## Comment Features

### Collapsible Details
Issues are wrapped in `<details>` tags to keep the comment clean.

### Checklist
Auto-generated action items as GitHub task list checkboxes.

### Links
File paths link to the specific line in the PR diff.

## Error Handling

- **No PR found**: Prompt user to provide PR number
- **gh not installed**: Show installation instructions
- **Comment failed**: Save comment to file as fallback
- **No issues found**: Post "clean" summary comment
